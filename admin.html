<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin cấu hình Bảng kê</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
                   "Segoe UI", sans-serif;
    }
    body {
      min-height: 100vh;
      padding: 16px;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
    }
    .shell {
      width: 100%;
      max-width: 1100px;
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 16px;
    }
    .panel {
      background: #020617;
      border-radius: 18px;
      border: 1px solid #1f2937;
      padding: 14px 14px 12px;
    }
    h1 {
      font-size: 18px;
      margin-bottom: 6px;
    }
    h2 {
      font-size: 14px;
      margin: 8px 0 4px;
    }
    .small {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .bk-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
      max-height: calc(100vh - 140px);
      overflow-y: auto;
      padding-right: 4px;
    }
    .bk {
      border-radius: 12px;
      border: 1px solid #1f2937;
      padding: 8px 10px 8px;
      background: #020617;
    }
    .bk-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }
    .bk-title {
      font-size: 13px;
      font-weight: 600;
    }
    .bk-sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .bk-actions {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #0f172a;
      border: 1px solid #1f2937;
      color: #9ca3af;
    }
    .btn-small {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
    }
    label {
      display: block;
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 2px;
      margin-top: 4px;
    }
    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      padding: 5px 7px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 12px;
    }
    textarea {
      min-height: 70px;
      resize: vertical;
    }
    .row-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }
    .file-row {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 6px;
      align-items: center;
    }
    input[type="file"] {
      font-size: 11px;
      color: #9ca3af;
    }
    .btn-main {
      margin-top: 8px;
      padding: 7px 12px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #052e16;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
    }
    #output {
      width: 100%;
      min-height: calc(100vh - 140px);
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1f2937;
      padding: 8px 10px;
      color: #e5e7eb;
      font-size: 11px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      resize: none;
    }
    .hint {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }
    @media (max-width: 960px) {
      .shell {
        grid-template-columns: minmax(0, 1fr);
      }
      #output {
        min-height: 220px;
      }
    }
  </style>
</head>
<body>
  <main class="shell">
    <section class="panel">
      <h1>Admin cấu hình Bảng kê</h1>
      <p class="small">
        Thêm / sửa các bảng kê ở đây. Sau đó bấm “Tạo BANG_KE_LIST” và copy đoạn mã sang file
        <code>index_onepage_bangke_theme_v4.html</code> (thay phần <b>BANG_KE_LIST</b> cũ).
      </p>

      <button class="btn-main" type="button" onclick="addBK()">+ Thêm bảng kê</button>

      <div class="bk-list" id="bkList"></div>
    </section>

    <section class="panel">
      <h2>Đoạn mã JS BANG_KE_LIST</h2>
      <p class="small">
        Copy toàn bộ đoạn này, dán đè vào phần <code>const BANG_KE_LIST = [...]</code> trong file giao diện.
      </p>
      <textarea id="output" readonly></textarea>
      <p class="hint">
        Gợi ý: bạn có thể lưu riêng đoạn này vào file <code>config-bangke.js</code> nếu muốn tách cấu hình.
      </p>
    </section>
  </main>

  <footer style="margin-top:12px;text-align:center;font-size:11px;color:#6b7280;">
    © baotg10
  </footer>

  <script>
    function esc(str) {
      return String(str)
        .replace(/\\/g, "\\\\")
        .replace(/"/g, "\\\"")
        .replace(/\r?\n/g, "\\n");
    }

    function addBK(data) {
      const list = document.getElementById('bkList');

      const wrap = document.createElement('div');
      wrap.className = 'bk';

      const header = document.createElement('div');
      header.className = 'bk-header';

      const titleBox = document.createElement('div');
      const t1 = document.createElement('div');
      t1.className = 'bk-title';
      t1.textContent = data?.name || 'Bảng kê mới';
      const t2 = document.createElement('div');
      t2.className = 'bk-sub';
      t2.textContent = data?.id ? ('ID: ' + data.id) : 'Chưa có ID';
      titleBox.appendChild(t1);
      titleBox.appendChild(t2);

      const actions = document.createElement('div');
      actions.className = 'bk-actions';
      const tag = document.createElement('div');
      tag.className = 'tag';
      tag.textContent = 'Excel';
      const btnDel = document.createElement('button');
      btnDel.type = 'button';
      btnDel.className = 'btn-small';
      btnDel.textContent = 'Xóa';
      btnDel.onclick = function () {
        wrap.remove();
        generate();
      };
      actions.appendChild(tag);
      actions.appendChild(btnDel);

      header.appendChild(titleBox);
      header.appendChild(actions);
      wrap.appendChild(header);

      const rowIds = document.createElement('div');
      rowIds.className = 'row-2';
      rowIds.innerHTML = `
        <div>
          <label>ID (không dấu, không khoảng trắng)</label>
          <input type="text" class="f-id" value="${data?.id || ''}" />
        </div>
        <div>
          <label>Code hiển thị (ví dụ: LD, TH)</label>
          <input type="text" class="f-code" value="${data?.code || ''}" />
        </div>
      `;
      wrap.appendChild(rowIds);

      const rowNames = document.createElement('div');
      rowNames.innerHTML = `
        <label>Tên hiển thị (ví dụ: Bảng kê LD)</label>
        <input type="text" class="f-name" value="${data?.name || ''}" />
        <label>Mô tả ngắn (chip bên cạnh, ví dụ: Mẫu Excel LD)</label>
        <input type="text" class="f-short" value="${data?.short || ''}" />
        <label>Mô tả chi tiết (hiện khi bung nội dung)</label>
        <input type="text" class="f-subtitle" value="${data?.subtitle || ''}" />
      `;
      wrap.appendChild(rowNames);

      const fileRow = document.createElement('div');
      fileRow.className = 'file-row';
      fileRow.innerHTML = `
        <div>
          <label>Tên file Excel (trên hosting, ví dụ: Bang_ke_LD.xlsx)</label>
          <input type="text" class="f-file" value="${data?.file || ''}" />
        </div>
        <div>
          <label>Ngày cập nhật (hiển trên từng bảng kê)</label>
          <input type="text" class="f-updated" placeholder="dd/mm/yyyy" value="${data?.updated || ''}" />
        </div>
      `;

      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = '.xlsx,.xls';
      fileInput.onchange = function () {
        if (fileInput.files[0]) {
          fileRow.querySelector('.f-file').value = fileInput.files[0].name;
          generate();
        }
      };
      const fileInputWrap = document.createElement('div');
      fileInputWrap.style.marginTop = '4px';
      fileInputWrap.appendChild(fileInput);
      fileRow.appendChild(fileInputWrap);

      wrap.appendChild(fileRow);

      const guideBox = document.createElement('div');
      guideBox.innerHTML = `
        <label>Hướng dẫn (mỗi dòng là một gạch đầu dòng)</label>
        <textarea class="f-guide">${data?.guide ? data.guide.join('\n') : ''}</textarea>
      `;
      wrap.appendChild(guideBox);

      list.appendChild(wrap);

      wrap.querySelectorAll('input,textarea').forEach(el => {
        el.addEventListener('input', () => {
          const nameVal = wrap.querySelector('.f-name').value.trim();
          t1.textContent = nameVal || 'Bảng kê mới';
          const idVal = wrap.querySelector('.f-id').value.trim();
          t2.textContent = idVal ? ('ID: ' + idVal) : 'Chưa có ID';
          generate();
        });
      });

      generate();
    }

    function collect() {
      const items = [];
      document.querySelectorAll('.bk').forEach(wrap => {
        const id = wrap.querySelector('.f-id').value.trim();
        if (!id) return;
        const code = wrap.querySelector('.f-code').value.trim();
        const name = wrap.querySelector('.f-name').value.trim();
        const short = wrap.querySelector('.f-short').value.trim();
        const subtitle = wrap.querySelector('.f-subtitle').value.trim();
        const file = wrap.querySelector('.f-file').value.trim();
        const updated = wrap.querySelector('.f-updated').value.trim();
        const guideRaw = wrap.querySelector('.f-guide').value;
        const guide = guideRaw
          .split(/\r?\n/)
          .map(s => s.trim())
          .filter(Boolean);
        items.push({ id, code, name, short, subtitle, file, updated, guide });
      });
      return items;
    }

    function generate() {
      const items = collect();
      let out = 'const BANG_KE_LIST = [\\n';
      items.forEach((it, idx) => {
        out += '  {\\n';
        out += '    id: "' + esc(it.id) + '",\\n';
        out += '    code: "' + esc(it.code) + '",\\n';
        out += '    name: "' + esc(it.name) + '",\\n';
        out += '    short: "' + esc(it.short) + '",\\n';
        out += '    subtitle: "' + esc(it.subtitle) + '",\\n';
        out += '    file: "' + esc(it.file) + '",\\n';
        out += '    updated: "' + esc(it.updated) + '",\\n';
        out += '    guide: [\\n';
        it.guide.forEach((g, i2) => {
          out += '      "' + esc(g) + '"';
          out += i2 < it.guide.length - 1 ? ',\\n' : '\\n';
        });
        out += '    ]\\n';
        out += idx < items.length - 1 ? '  },\\n' : '  }\\n';
      });
      out += '];\\n';
      document.getElementById('output').value = out;
    }

    function seedDefault() {
      addBK({
        id: 'ld',
        code: 'LD',
        name: 'Bảng kê LD',
        short: 'Mẫu Excel LD',
        subtitle: 'File Excel theo dõi và tính lãi dạng LD',
        file: 'Bang_ke_LD.xlsx',
        updated: '10/11/2025',
        guide: [
          'Nhập kỳ (tháng/quý/năm) và các thông tin LD ở từng dòng.',
          'Điền số tiền gốc, lãi suất, số ngày/kỳ theo mẫu trong file.',
          'Các cột tổng, lãi và số dư đã có công thức, không cần sửa trực tiếp.',
          'Nếu cần đổi cách tính, chỉnh công thức ở hàng mẫu rồi sao chép xuống.',
          'Nên lưu 1 bản gốc, làm việc trên bản sao để tránh mất cấu trúc ban đầu.'
        ]
      });
      addBK({
        id: 'the',
        code: 'TH',
        name: 'Bảng kê Thẻ',
        short: 'Mẫu Excel Thẻ',
        subtitle: 'File Excel theo dõi giao dịch và lãi theo thẻ',
        file: 'Bang_ke_The.xlsx',
        updated: '10/11/2025',
        guide: [
          'Nhập kỳ sao kê, số dư đầu kỳ và hạn mức thẻ (nếu có).',
          'Ghi các giao dịch phát sinh đúng cột: chi tiêu, hoàn tiền, phí, v.v.',
          'Các cột tính lãi, phí phạt và số dư cuối kỳ đã có sẵn công thức.',
          'Có thể tách mỗi thẻ thành một sheet riêng để quản lý cho rõ ràng.',
          'Nên lưu 1 bản gốc, thao tác trên bản sao để tránh hỏng công thức.'
        ]
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      seedDefault();
    });
  </script>
</body>
</html>

